# Shortest Remaining Time First (SRTF) Scheduling Algorithm

# Function to find the waiting time for all processes
def findWaitingTime(processes, n, wt):
    # Remaining time for each process
    rt = [processes[i][1] for i in range(n)]

    complete = 0        # Number of completed processes
    t = 0               # Current time
    minm = 999999999    # Minimum remaining time
    short = 0           # Index of the shortest process
    check = False       # Flag to check if any process is found

    # Process until all processes are completed
    while complete != n:
        # Find process with minimum remaining time among the arrived ones
        for j in range(n):
            if (processes[j][2] <= t) and (rt[j] < minm) and rt[j] > 0:
                minm = rt[j]
                short = j
                check = True

        # If no process is found for the current time
        if not check:
            t += 1
            continue

        # Reduce remaining time by one
        rt[short] -= 1
        minm = rt[short]

        if minm == 0:
            minm = 999999999

        # If a process gets completely executed
        if rt[short] == 0:
            complete += 1
            check = False
            fint = t + 1  # Finish time of the current process

            # Calculate waiting time = Finish time - Burst time - Arrival time
            wt[short] = fint - processes[short][1] - processes[short][2]
            if wt[short] < 0:
                wt[short] = 0

        # Increment time
        t += 1


# Function to calculate Turnaround Time
def findTurnAroundTime(processes, n, wt, tat):
    for i in range(n):
        tat[i] = processes[i][1] + wt[i]


# Function to calculate and display Average Times
def findavgTime(processes, n):
    wt = [0] * n
    tat = [0] * n

    # Calculate waiting time and turnaround time
    findWaitingTime(processes, n, wt)
    findTurnAroundTime(processes, n, wt, tat)

    print("Process\tBurst Time\tArrival Time\tWaiting Time\tTurnaround Time")

    total_wt = 0
    total_tat = 0

    # Display process details
    for i in range(n):
        total_wt += wt[i]
        total_tat += tat[i]
        print(f"P{processes[i][0]}\t\t{processes[i][1]}\t\t{processes[i][2]}"
              f"\t\t{wt[i]}\t\t{tat[i]}")

    # Display averages
    print("\nAverage Waiting Time = %.2f" % (total_wt / n))
    print("Average Turnaround Time = %.2f" % (total_tat / n))


# --------------------- DRIVER CODE ---------------------
if __name__ == "__main__":
    # Process ID, Burst Time, Arrival Time
    processes = [
        [1, 6, 1],
        [2, 8, 1],
        [3, 7, 2],
        [4, 3, 3]
    ]
    n = len(processes)

    findavgTime(processes, n)
